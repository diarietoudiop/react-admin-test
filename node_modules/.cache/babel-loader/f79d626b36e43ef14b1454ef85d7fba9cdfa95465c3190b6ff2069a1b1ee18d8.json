{"ast":null,"code":"import { useCallback } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport { useNotificationContext } from '../notification';\nimport { useBasename } from '../routing';\nimport useAuthProvider, { defaultAuthParams } from './useAuthProvider';\nimport { removeDoubleSlashes } from '../routing/useCreatePath';\nimport { useQueryClient } from '@tanstack/react-query';\n/**\n * Get a callback for calling the authProvider.login() method\n * and redirect to the previous authenticated page (or the home page) on success.\n *\n * @see useAuthProvider\n *\n * @returns {Function} login callback\n *\n * @example\n *\n * import { useLogin } from 'react-admin';\n *\n * const LoginButton = () => {\n *     const [loading, setLoading] = useState(false);\n *     const login = useLogin();\n *     const handleClick = {\n *         setLoading(true);\n *         login({ username: 'john', password: 'p@ssw0rd' }, '/posts')\n *             .then(() => setLoading(false));\n *     }\n *     return <button onClick={handleClick}>Login</button>;\n * }\n */\nvar useLogin = function () {\n  var authProvider = useAuthProvider();\n  var queryClient = useQueryClient();\n  var location = useLocation();\n  var locationState = location.state;\n  var navigate = useNavigate();\n  var basename = useBasename();\n  var resetNotifications = useNotificationContext().resetNotifications;\n  var nextPathName = locationState && locationState.nextPathname;\n  var nextSearch = locationState && locationState.nextSearch;\n  var afterLoginUrl = removeDoubleSlashes(\"\".concat(basename, \"/\").concat(defaultAuthParams.afterLoginUrl));\n  var login = useCallback(function (params, pathName) {\n    if (params === void 0) {\n      params = {};\n    }\n    if (authProvider) {\n      return authProvider.login(params).then(function (ret) {\n        resetNotifications();\n        queryClient.invalidateQueries({\n          queryKey: ['auth', 'getPermissions']\n        });\n        if (ret && ret.hasOwnProperty('redirectTo')) {\n          if (ret) {\n            navigate(ret.redirectTo);\n          }\n        } else {\n          var redirectUrl = pathName ? pathName : nextPathName + nextSearch || afterLoginUrl;\n          navigate(redirectUrl);\n        }\n        return ret;\n      });\n    } else {\n      resetNotifications();\n      navigate(afterLoginUrl);\n      return Promise.resolve();\n    }\n  }, [authProvider, queryClient, navigate, nextPathName, nextSearch, resetNotifications, afterLoginUrl]);\n  return login;\n};\nexport default useLogin;","map":{"version":3,"names":["useCallback","useLocation","useNavigate","useNotificationContext","useBasename","useAuthProvider","defaultAuthParams","removeDoubleSlashes","useQueryClient","useLogin","authProvider","queryClient","location","locationState","state","navigate","basename","resetNotifications","nextPathName","nextPathname","nextSearch","afterLoginUrl","concat","login","params","pathName","then","ret","invalidateQueries","queryKey","hasOwnProperty","redirectTo","redirectUrl","Promise","resolve"],"sources":["/home/diarietou/Bureau/afterSA/test/testfront/react-admin-test/node_modules/ra-core/src/auth/useLogin.ts"],"sourcesContent":["import { useCallback } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\n\nimport { useNotificationContext } from '../notification';\nimport { useBasename } from '../routing';\nimport useAuthProvider, { defaultAuthParams } from './useAuthProvider';\nimport { removeDoubleSlashes } from '../routing/useCreatePath';\nimport { useQueryClient } from '@tanstack/react-query';\n\n/**\n * Get a callback for calling the authProvider.login() method\n * and redirect to the previous authenticated page (or the home page) on success.\n *\n * @see useAuthProvider\n *\n * @returns {Function} login callback\n *\n * @example\n *\n * import { useLogin } from 'react-admin';\n *\n * const LoginButton = () => {\n *     const [loading, setLoading] = useState(false);\n *     const login = useLogin();\n *     const handleClick = {\n *         setLoading(true);\n *         login({ username: 'john', password: 'p@ssw0rd' }, '/posts')\n *             .then(() => setLoading(false));\n *     }\n *     return <button onClick={handleClick}>Login</button>;\n * }\n */\nconst useLogin = (): Login => {\n    const authProvider = useAuthProvider();\n    const queryClient = useQueryClient();\n    const location = useLocation();\n    const locationState = location.state as any;\n    const navigate = useNavigate();\n    const basename = useBasename();\n    const { resetNotifications } = useNotificationContext();\n    const nextPathName = locationState && locationState.nextPathname;\n    const nextSearch = locationState && locationState.nextSearch;\n    const afterLoginUrl = removeDoubleSlashes(\n        `${basename}/${defaultAuthParams.afterLoginUrl}`\n    );\n\n    const login = useCallback(\n        (params: any = {}, pathName) => {\n            if (authProvider) {\n                return authProvider.login(params).then(ret => {\n                    resetNotifications();\n                    queryClient.invalidateQueries({\n                        queryKey: ['auth', 'getPermissions'],\n                    });\n                    if (ret && ret.hasOwnProperty('redirectTo')) {\n                        if (ret) {\n                            navigate(ret.redirectTo);\n                        }\n                    } else {\n                        const redirectUrl = pathName\n                            ? pathName\n                            : nextPathName + nextSearch || afterLoginUrl;\n                        navigate(redirectUrl);\n                    }\n                    return ret;\n                });\n            } else {\n                resetNotifications();\n                navigate(afterLoginUrl);\n                return Promise.resolve();\n            }\n        },\n        [\n            authProvider,\n            queryClient,\n            navigate,\n            nextPathName,\n            nextSearch,\n            resetNotifications,\n            afterLoginUrl,\n        ]\n    );\n\n    return login;\n};\n\n/**\n * Log a user in by calling the authProvider.login() method\n *\n * @param {Object} params Login parameters to pass to the authProvider. May contain username/email, password, etc\n * @param {string} pathName The path to redirect to after login. By default, redirects to the home page, or to the last page visited after disconnection.\n *\n * @return {Promise} The authProvider response\n */\ntype Login = (params: any, pathName?: string) => Promise<any>;\n\nexport default useLogin;\n"],"mappings":"AAAA,SAASA,WAAW,QAAQ,OAAO;AACnC,SAASC,WAAW,EAAEC,WAAW,QAAQ,kBAAkB;AAE3D,SAASC,sBAAsB,QAAQ,iBAAiB;AACxD,SAASC,WAAW,QAAQ,YAAY;AACxC,OAAOC,eAAe,IAAIC,iBAAiB,QAAQ,mBAAmB;AACtE,SAASC,mBAAmB,QAAQ,0BAA0B;AAC9D,SAASC,cAAc,QAAQ,uBAAuB;AAEtD;;;;;;;;;;;;;;;;;;;;;;;AAuBA,IAAMC,QAAQ,GAAG,SAAAA,CAAA;EACb,IAAMC,YAAY,GAAGL,eAAe,EAAE;EACtC,IAAMM,WAAW,GAAGH,cAAc,EAAE;EACpC,IAAMI,QAAQ,GAAGX,WAAW,EAAE;EAC9B,IAAMY,aAAa,GAAGD,QAAQ,CAACE,KAAY;EAC3C,IAAMC,QAAQ,GAAGb,WAAW,EAAE;EAC9B,IAAMc,QAAQ,GAAGZ,WAAW,EAAE;EACtB,IAAAa,kBAAkB,GAAKd,sBAAsB,EAAE,CAAAc,kBAA7B;EAC1B,IAAMC,YAAY,GAAGL,aAAa,IAAIA,aAAa,CAACM,YAAY;EAChE,IAAMC,UAAU,GAAGP,aAAa,IAAIA,aAAa,CAACO,UAAU;EAC5D,IAAMC,aAAa,GAAGd,mBAAmB,CACrC,GAAAe,MAAA,CAAGN,QAAQ,OAAAM,MAAA,CAAIhB,iBAAiB,CAACe,aAAa,CAAE,CACnD;EAED,IAAME,KAAK,GAAGvB,WAAW,CACrB,UAACwB,MAAgB,EAAEC,QAAQ;IAA1B,IAAAD,MAAA;MAAAA,MAAA,KAAgB;IAAA;IACb,IAAId,YAAY,EAAE;MACd,OAAOA,YAAY,CAACa,KAAK,CAACC,MAAM,CAAC,CAACE,IAAI,CAAC,UAAAC,GAAG;QACtCV,kBAAkB,EAAE;QACpBN,WAAW,CAACiB,iBAAiB,CAAC;UAC1BC,QAAQ,EAAE,CAAC,MAAM,EAAE,gBAAgB;SACtC,CAAC;QACF,IAAIF,GAAG,IAAIA,GAAG,CAACG,cAAc,CAAC,YAAY,CAAC,EAAE;UACzC,IAAIH,GAAG,EAAE;YACLZ,QAAQ,CAACY,GAAG,CAACI,UAAU,CAAC;;SAE/B,MAAM;UACH,IAAMC,WAAW,GAAGP,QAAQ,GACtBA,QAAQ,GACRP,YAAY,GAAGE,UAAU,IAAIC,aAAa;UAChDN,QAAQ,CAACiB,WAAW,CAAC;;QAEzB,OAAOL,GAAG;MACd,CAAC,CAAC;KACL,MAAM;MACHV,kBAAkB,EAAE;MACpBF,QAAQ,CAACM,aAAa,CAAC;MACvB,OAAOY,OAAO,CAACC,OAAO,EAAE;;EAEhC,CAAC,EACD,CACIxB,YAAY,EACZC,WAAW,EACXI,QAAQ,EACRG,YAAY,EACZE,UAAU,EACVH,kBAAkB,EAClBI,aAAa,CAChB,CACJ;EAED,OAAOE,KAAK;AAChB,CAAC;AAYD,eAAed,QAAQ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import { useContext, useMemo } from 'react';\nimport { useQueryClient } from '@tanstack/react-query';\nimport DataProviderContext from './DataProviderContext';\nimport { defaultDataProvider } from './defaultDataProvider';\nimport validateResponseFormat from './validateResponseFormat';\nimport useLogoutIfAccessDenied from '../auth/useLogoutIfAccessDenied';\nimport { reactAdminFetchActions } from './dataFetchActions';\nimport { populateQueryCache } from './populateQueryCache';\n/**\n * Hook for getting a dataProvider\n *\n * Gets a dataProvider object, which behaves just like the real dataProvider\n * (same methods returning a Promise). But it's actually a Proxy object,\n * which validates the response format, and logs the user out upon error\n * if authProvider.checkError() rejects.\n *\n * @return dataProvider\n *\n * @example Basic usage\n *\n * import * as React from 'react';\n * import { useState } from 'react';\n * import { useDataProvider } from 'react-admin';\n *\n * const PostList = () => {\n *      const [posts, setPosts] = useState([])\n *      const dataProvider = useDataProvider();\n *      useEffect(() => {\n *          dataProvider.getList('posts', { filter: { status: 'pending' }})\n *            .then(({ data }) => setPosts(data));\n *      }, [])\n *\n *      return (\n *          <Fragment>\n *              {posts.map((post, key) => <PostDetail post={post} key={key} />)}\n *          </Fragment>\n *     );\n * }\n *\n * @example Handling all states (loading, error, success)\n *\n * import { useState, useEffect } from 'react';\n * import { useDataProvider } from 'react-admin';\n *\n * const UserProfile = ({ userId }) => {\n *     const dataProvider = useDataProvider();\n *     const [user, setUser] = useState();\n *     const [loading, setLoading] = useState(true);\n *     const [error, setError] = useState();\n *     useEffect(() => {\n *         dataProvider.getOne('users', { id: userId })\n *             .then(({ data }) => {\n *                 setUser(data);\n *                 setLoading(false);\n *             })\n *             .catch(error => {\n *                 setError(error);\n *                 setLoading(false);\n *             })\n *     }, []);\n *\n *     if (loading) return <Loading />;\n *     if (error) return <Error />\n *     if (!user) return null;\n *\n *     return (\n *         <ul>\n *             <li>Name: {user.name}</li>\n *             <li>Email: {user.email}</li>\n *         </ul>\n *     )\n * }\n */\nvar arrayReturnTypes = ['getList', 'getMany', 'getManyReference'];\nexport var useDataProvider = function () {\n  var dataProvider = useContext(DataProviderContext) || defaultDataProvider;\n  var queryClient = useQueryClient();\n  var logoutIfAccessDenied = useLogoutIfAccessDenied();\n  var dataProviderProxy = useMemo(function () {\n    return new Proxy(dataProvider, {\n      get: function (_, name) {\n        if (typeof name === 'symbol' || name === 'then') {\n          return;\n        }\n        if (name === 'supportAbortSignal') {\n          return dataProvider.supportAbortSignal;\n        }\n        return function () {\n          var args = [];\n          for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n          }\n          var type = name.toString();\n          if (typeof dataProvider[type] !== 'function') {\n            throw new Error(\"Unknown dataProvider function: \".concat(type));\n          }\n          try {\n            return dataProvider[type].apply(dataProvider, args).then(function (response) {\n              var _a;\n              if (process.env.NODE_ENV !== 'production' && reactAdminFetchActions.includes(type)) {\n                validateResponseFormat(response, type);\n              }\n              if ((_a = response === null || response === void 0 ? void 0 : response.meta) === null || _a === void 0 ? void 0 : _a.prefetched) {\n                populateQueryCache({\n                  data: response === null || response === void 0 ? void 0 : response.meta.prefetched,\n                  queryClient: queryClient\n                });\n              }\n              return response;\n            }).catch(function (error) {\n              if (process.env.NODE_ENV !== 'production' &&\n              // do not log AbortErrors\n              !isAbortError(error)) {\n                console.error(error);\n              }\n              return logoutIfAccessDenied(error).then(function (loggedOut) {\n                if (loggedOut) return {\n                  data: arrayReturnTypes.includes(type) ? [] : {}\n                };\n                throw error;\n              });\n            });\n          } catch (e) {\n            if (process.env.NODE_ENV !== 'production') {\n              console.error(e);\n            }\n            throw new Error('The dataProvider threw an error. It should return a rejected Promise instead.');\n          }\n        };\n      }\n    });\n  }, [dataProvider, logoutIfAccessDenied, queryClient]);\n  return dataProviderProxy;\n};\nvar isAbortError = function (error) {\n  return error instanceof DOMException && error.name === 'AbortError';\n};","map":{"version":3,"names":["useContext","useMemo","useQueryClient","DataProviderContext","defaultDataProvider","validateResponseFormat","useLogoutIfAccessDenied","reactAdminFetchActions","populateQueryCache","arrayReturnTypes","useDataProvider","dataProvider","queryClient","logoutIfAccessDenied","dataProviderProxy","Proxy","get","_","name","supportAbortSignal","args","_i","arguments","length","type","toString","Error","concat","apply","then","response","process","env","NODE_ENV","includes","_a","meta","prefetched","data","catch","error","isAbortError","console","loggedOut","e","DOMException"],"sources":["/home/diarietou/Bureau/afterSA/test/testfront/react-admin-test/node_modules/ra-core/src/dataProvider/useDataProvider.ts"],"sourcesContent":["import { useContext, useMemo } from 'react';\nimport { useQueryClient } from '@tanstack/react-query';\n\nimport DataProviderContext from './DataProviderContext';\nimport { defaultDataProvider } from './defaultDataProvider';\nimport validateResponseFormat from './validateResponseFormat';\nimport { DataProvider } from '../types';\nimport useLogoutIfAccessDenied from '../auth/useLogoutIfAccessDenied';\nimport { reactAdminFetchActions } from './dataFetchActions';\nimport { populateQueryCache } from './populateQueryCache';\n\n/**\n * Hook for getting a dataProvider\n *\n * Gets a dataProvider object, which behaves just like the real dataProvider\n * (same methods returning a Promise). But it's actually a Proxy object,\n * which validates the response format, and logs the user out upon error\n * if authProvider.checkError() rejects.\n *\n * @return dataProvider\n *\n * @example Basic usage\n *\n * import * as React from 'react';\n * import { useState } from 'react';\n * import { useDataProvider } from 'react-admin';\n *\n * const PostList = () => {\n *      const [posts, setPosts] = useState([])\n *      const dataProvider = useDataProvider();\n *      useEffect(() => {\n *          dataProvider.getList('posts', { filter: { status: 'pending' }})\n *            .then(({ data }) => setPosts(data));\n *      }, [])\n *\n *      return (\n *          <Fragment>\n *              {posts.map((post, key) => <PostDetail post={post} key={key} />)}\n *          </Fragment>\n *     );\n * }\n *\n * @example Handling all states (loading, error, success)\n *\n * import { useState, useEffect } from 'react';\n * import { useDataProvider } from 'react-admin';\n *\n * const UserProfile = ({ userId }) => {\n *     const dataProvider = useDataProvider();\n *     const [user, setUser] = useState();\n *     const [loading, setLoading] = useState(true);\n *     const [error, setError] = useState();\n *     useEffect(() => {\n *         dataProvider.getOne('users', { id: userId })\n *             .then(({ data }) => {\n *                 setUser(data);\n *                 setLoading(false);\n *             })\n *             .catch(error => {\n *                 setError(error);\n *                 setLoading(false);\n *             })\n *     }, []);\n *\n *     if (loading) return <Loading />;\n *     if (error) return <Error />\n *     if (!user) return null;\n *\n *     return (\n *         <ul>\n *             <li>Name: {user.name}</li>\n *             <li>Email: {user.email}</li>\n *         </ul>\n *     )\n * }\n */\n\nconst arrayReturnTypes = ['getList', 'getMany', 'getManyReference'];\n\nexport const useDataProvider = <\n    TDataProvider extends DataProvider = DataProvider,\n>(): TDataProvider => {\n    const dataProvider = (useContext(DataProviderContext) ||\n        defaultDataProvider) as unknown as TDataProvider;\n    const queryClient = useQueryClient();\n\n    const logoutIfAccessDenied = useLogoutIfAccessDenied();\n\n    const dataProviderProxy = useMemo(() => {\n        return new Proxy(dataProvider, {\n            get: (_, name) => {\n                if (typeof name === 'symbol' || name === 'then') {\n                    return;\n                }\n                if (name === 'supportAbortSignal') {\n                    return dataProvider.supportAbortSignal;\n                }\n                return (...args) => {\n                    const type = name.toString();\n\n                    if (typeof dataProvider[type] !== 'function') {\n                        throw new Error(\n                            `Unknown dataProvider function: ${type}`\n                        );\n                    }\n\n                    try {\n                        return dataProvider[type]\n                            .apply(dataProvider, args)\n                            .then(response => {\n                                if (\n                                    process.env.NODE_ENV !== 'production' &&\n                                    reactAdminFetchActions.includes(type)\n                                ) {\n                                    validateResponseFormat(response, type);\n                                }\n                                if (response?.meta?.prefetched) {\n                                    populateQueryCache({\n                                        data: response?.meta.prefetched,\n                                        queryClient,\n                                    });\n                                }\n                                return response;\n                            })\n                            .catch(error => {\n                                if (\n                                    process.env.NODE_ENV !== 'production' &&\n                                    // do not log AbortErrors\n                                    !isAbortError(error)\n                                ) {\n                                    console.error(error);\n                                }\n                                return logoutIfAccessDenied(error).then(\n                                    loggedOut => {\n                                        if (loggedOut)\n                                            return {\n                                                data: arrayReturnTypes.includes(\n                                                    type\n                                                )\n                                                    ? []\n                                                    : {},\n                                            };\n                                        throw error;\n                                    }\n                                );\n                            });\n                    } catch (e) {\n                        if (process.env.NODE_ENV !== 'production') {\n                            console.error(e);\n                        }\n                        throw new Error(\n                            'The dataProvider threw an error. It should return a rejected Promise instead.'\n                        );\n                    }\n                };\n            },\n        });\n    }, [dataProvider, logoutIfAccessDenied, queryClient]);\n\n    return dataProviderProxy;\n};\n\nconst isAbortError = error =>\n    error instanceof DOMException &&\n    (error as DOMException).name === 'AbortError';\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}